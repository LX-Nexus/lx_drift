
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://lx-nexus.github.io/lx_drift/guide_split/10_Database_Implementation_with_SQLite3.html">
      
      
        <link rel="prev" href="9_data_handling_and_lexi_driftpdf.html">
      
      
        <link rel="next" href="11_Considerations_for_the_Database_Developer.html">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>10. Database Implementation with SQLite3 - Lexi Drift Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#10-database-implementation-with-sqlite3" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Lexi Drift Documentation" class="md-header__button md-logo" aria-label="Lexi Drift Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Lexi Drift Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              10. Database Implementation with SQLite3
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Lexi Drift Documentation" class="md-nav__button md-logo" aria-label="Lexi Drift Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Lexi Drift Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UI Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            UI Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="1_introduction_to_lexi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1. Introduction to Lexi
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="2_codebase_overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2. Codebase Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="3_ui_architecture_with_flet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3. UI Architecture with Flet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="4_base64_for_images_and_animations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4. Base64 for Images and Animations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="5_ui_development_guidelines.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5. UI Development Guidelines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="6_contribution_workflow.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6. Contribution Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="7_resources.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7. Resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="8_detailed_ui_elements_and_functionality.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8. Detailed UI Elements and Functionality
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="9_data_handling_and_lexi_driftpdf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    9. Data Handling and `lexi_drift.pdf`
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Database Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Database Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    10. Database Implementation with SQLite3
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="10_Database_Implementation_with_SQLite3.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    10. Database Implementation with SQLite3
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#101-overview-of-sqlite3-in-lexi" class="md-nav__link">
    <span class="md-ellipsis">
      10.1. Overview of SQLite3 in Lexi
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#102-core-concepts-for-sqlite3-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      10.2. Core Concepts for SQLite3 Implementation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#103-integration-points-in-drift_minipy" class="md-nav__link">
    <span class="md-ellipsis">
      10.3. Integration Points in Drift_mini.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-application-initialization-main-function" class="md-nav__link">
    <span class="md-ellipsis">
      1. Application Initialization (main function)**:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-user-email-collection-eg-during-first-time-setup-or-registration" class="md-nav__link">
    <span class="md-ellipsis">
      2. User Email Collection (e.g., during first-time setup or registration):
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-usage-data-logging-various-interaction-points" class="md-nav__link">
    <span class="md-ellipsis">
      3. Usage Data Logging (various interaction points):
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-data-upload-mechanism-background-task-or-on-app-close" class="md-nav__link">
    <span class="md-ellipsis">
      4. Data Upload Mechanism (background task or on app close):
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="11_Considerations_for_the_Database_Developer.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    11. Considerations for the Database Developer
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="10-database-implementation-with-sqlite3">10. Database Implementation with SQLite3<a class="headerlink" href="#10-database-implementation-with-sqlite3" title="Permanent link">&para;</a></h1>
<p>Lexi will incorporate two SQLite3 databases to manage user-specific data and application usage metrics. SQLite3 is an embedded, serverless, zero-configuration, transactional SQL database engine, making it an ideal choice for local data storage within applications like Lexi. Its simplicity and file-based nature ensure easy deployment and portability, as the entire database is contained within a single file.</p>
<h3 id="101-overview-of-sqlite3-in-lexi">10.1. Overview of SQLite3 in Lexi<a class="headerlink" href="#101-overview-of-sqlite3-in-lexi" title="Permanent link">&para;</a></h3>
<p>SQLite3 databases will be stored directly alongside the Lexi application, providing a robust yet lightweight solution for persistent data storage. This approach eliminates the need for a separate database server, simplifying the application's architecture and reducing operational overhead. The two distinct databases will serve specific purposes:</p>
<p><strong>1.User Email Database</strong>: This database will securely store user email addresses, primarily for authentication, communication, or personalized features within Lexi. It will ensure that user contact information is managed efficiently and locally.</p>
<p><strong>2.Usage Data Database</strong>: This database will collect specific usage data from Lexi when the application is used offline. This data is crucial for understanding user interaction patterns, identifying popular features, and improving the overall user experience. Once an internet connection is available, this usage information will be automatically uploaded to an admin dashboard for centralized viewing and analysis.</p>
<h3 id="102-core-concepts-for-sqlite3-implementation">10.2. Core Concepts for SQLite3 Implementation<a class="headerlink" href="#102-core-concepts-for-sqlite3-implementation" title="Permanent link">&para;</a></h3>
<p>Implementing SQLite3 in Python is straightforward, primarily utilizing the built-in sqlite3 module. The fundamental steps involve connecting to a database, creating tables, inserting data, querying data, and closing the connection. For Lexi, these operations will need to be integrated carefully to ensure data integrity and application responsiveness.</p>
<p><strong>Connecting to a Database</strong>:</p>
<p>To interact with an SQLite3 database, you first need to establish a connection. If the specified database file does not exist, SQLite3 will automatically create it. This connection object is your gateway to performing database operations.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_db_connection</span><span class="p">(</span><span class="n">db_name</span><span class="p">):</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>  <span class="c1"># This allows accessing columns by name</span>
    <span class="k">return</span> <span class="n">conn</span>
</code></pre></div>
<p><strong>Creating Tables</strong>:</p>
<p>Once connected, you can create tables to define the structure of your data. It's good practice to check if a table already exists before attempting to create it, using CREATE TABLE IF NOT EXISTS.</p>
<p><div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_tables</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="c1"># Table for user emails</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        CREATE TABLE IF NOT EXISTS users (</span>
<span class="s1">            id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s1">            email TEXT NOT NULL UNIQUE,</span>
<span class="s1">            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>
<span class="s1">        )</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span>
    <span class="c1"># Table for offline usage data</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        CREATE TABLE IF NOT EXISTS usage_data (</span>
<span class="s1">            id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s1">            user_id INTEGER,</span>
<span class="s1">            feature_used TEXT NOT NULL,</span>
<span class="s1">            timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,</span>
<span class="s1">            data_payload TEXT, # e.g., JSON string of specific usage details</span>
<span class="s1">            uploaded BOOLEAN DEFAULT 0, # 0 for not uploaded, 1 for uploaded</span>
<span class="s1">            FOREIGN KEY (user_id) REFERENCES users(id)</span>
<span class="s1">        )</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div>
<strong>Inserting Data</strong>:</p>
<p>Data can be inserted into tables using SQL INSERT statements. It's crucial to use parameterized queries (e.g., ? placeholders) to prevent SQL injection vulnerabilities.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">insert_user_email</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO users (email) VALUES (?)</span>


<span class="p">,</span> <span class="p">(</span><span class="n">email</span><span class="p">))</span>


<span class="p">,</span> <span class="p">(</span><span class="n">email</span><span class="p">))</span><span class="s2">&quot;</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO users (email) VALUES (?)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">email</span><span class="p">,))</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cursor</span><span class="o">.</span><span class="n">lastrowid</span>
    <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Email </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2"> already exists.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">insert_usage_data</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">feature_used</span><span class="p">,</span> <span class="n">data_payload</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s2">&quot;INSERT INTO usage_data (user_id, feature_used, data_payload) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
        <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">feature_used</span><span class="p">,</span> <span class="n">data_payload</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">cursor</span><span class="o">.</span><span class="n">lastrowid</span>
</code></pre></div>
<p><strong>Querying Data</strong>:</p>
<p>Retrieving data is done using SELECT statements. The conn.row_factory = sqlite3.Row setting is particularly useful as it allows accessing columns by name, similar to a dictionary.</p>
<p><div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_user_by_email</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM users WHERE email = ?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">email</span><span class="p">,))</span>
    <span class="k">return</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_unuploaded_usage_data</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM usage_data WHERE uploaded = 0&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</code></pre></div>
<strong>Updating Data</strong>:</p>
<p>To mark usage data as uploaded, an UPDATE statement can be used.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mark_usage_data_uploaded</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">data_ids</span><span class="p">):</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="c1"># Using a placeholder for each ID to prevent SQL injection</span>
    <span class="n">placeholders</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;?&quot;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">data_ids</span><span class="p">])</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE usage_data SET uploaded = 1 WHERE id IN (</span><span class="si">{</span><span class="n">placeholders</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">data_ids</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div>
<h3 id="103-integration-points-in-drift_minipy">10.3.  Integration Points in Drift_mini.py<a class="headerlink" href="#103-integration-points-in-drift_minipy" title="Permanent link">&para;</a></h3>
<p>Given the current structure of Drift_mini.py, the database functionalities will need to be integrated at several key points. The goal is to ensure that database operations are performed efficiently and without disrupting the existing UI and AI logic.</p>
<h3 id="1-application-initialization-main-function">1. Application Initialization (main function)**:<a class="headerlink" href="#1-application-initialization-main-function" title="Permanent link">&para;</a></h3>
<p>Upon application startup, the database connections should be established, and tables should be created if they don't already exist. This ensures that the database is ready for use as soon as Lexi launches.</p>
<p><strong>•Proposed Location</strong>: Within the main function, early in the execution flow, perhaps after the initial Flet page setup and before model loading.</p>
<p><strong>•Example Integration</strong>:</p>
<h3 id="2-user-email-collection-eg-during-first-time-setup-or-registration">2. User Email Collection (e.g., during first-time setup or registration):<a class="headerlink" href="#2-user-email-collection-eg-during-first-time-setup-or-registration" title="Permanent link">&para;</a></h3>
<p>If Lexi introduces a feature requiring user email input (e.g., for newsletters, account creation, or personalized settings), this is where the insert_user_email function would be called.</p>
<p><strong>•Proposed Location</strong>: Within a new Flet dialog or form that prompts the user for their email address. This would likely be triggered by a button click or as part of an onboarding flow.</p>
<p><strong>•Example Integration (Conceptual)</strong>:</p>
<h3 id="3-usage-data-logging-various-interaction-points">3. Usage Data Logging (various interaction points):<a class="headerlink" href="#3-usage-data-logging-various-interaction-points" title="Permanent link">&para;</a></h3>
<p>Every significant user interaction or feature usage within Lexi should trigger a call to log data into the usage_data.db. This includes, but is not limited to:</p>
<p><strong>•Chat interactions</strong>: Each time a user sends a message or receives a response.</p>
<p><strong>•PDF processing</strong>: When a PDF is loaded, processed, or summarized.</p>
<p><strong>•Model changes</strong>: When the user switches between different AI models.</p>
<p><strong>•Tool usage</strong>: If Lexi integrates external tools or functionalities.</p>
<p><strong>•Proposed Location</strong>: Within the respective event handlers or functions that manage these interactions. For instance, in the send_message function for chat, or within the PDF loading logic.</p>
<p><strong>•Example Integration (Conceptual for chat)</strong>:</p>
<h3 id="4-data-upload-mechanism-background-task-or-on-app-close">4. Data Upload Mechanism (background task or on app close):<a class="headerlink" href="#4-data-upload-mechanism-background-task-or-on-app-close" title="Permanent link">&para;</a></h3>
<p>A mechanism is needed to periodically check for unuploaded usage data and send it to the admin dashboard. This could be a background thread that runs at intervals or a process that triggers when the application is closed or an internet connection is detected.</p>
<p><strong>•Proposed Location</strong>: A separate asynchronous function that can be called periodically (e.g., using asyncio.sleep within a loop) or triggered by network status changes. It should also be considered for execution during graceful application shutdown.</p>
<p><strong>•Example Integration (Conceptual):</strong></p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.top", "content.code.annotate", "content.code.copy", "content.tabs.link", "toc.follow", "toc.integrate"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>